{% load static %}
<div class="kanban-col bg-gray-50 rounded-xl shadow-2xl overflow-hidden flex flex-col flex-shrink-0">
    
    <h3 class="p-4 text-base font-extrabold bg-white border-b-4 {{ color }} flex justify-between items-center transition-colors">
        
        <span>
            <span>
                {% if status_key == 'CAPACITACION_PRACTICA' %}
                    OJT 
                {% elif status_key == 'CONVOCADO' %}
                    Convocado {% else %}
                    {{ title }}
                {% endif %}
            </span>
            <span class="ml-2 px-2 py-0.5 bg-sky-800 text-white text-xs font-black rounded-full shadow-md shadow-red-200" id="count-{{ status_key }}">
                {{ data|length }}
            </span>
        </span>

        {% if status_key == 'REGISTRADO' %}
            <div class="flex items-center space-x-3 text-sm">
                
                <label class="group relative flex items-center font-semibold text-gray-800 cursor-pointer select-none">
    
                    <input type="checkbox" id="selectAll-REGISTRADO" 
                        class="sr-only peer"> 
                            
                    <div class="h-5 w-5 border-2 border-sky-800 rounded-md mr-1 flex items-center justify-center 
                                peer-checked:bg-red-600 peer-checked:border-red-600 transition duration-300 ease-in-out shadow-sm">
                        
                        <svg class="h-3 w-3 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-300" 
                            fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    
                    <span class="text-xs ml-1 uppercase tracking-wider font-extrabold mr-2">
                        Todo
                    </span>

                    <div class="absolute top-full mt-1.5 left-0 
                                bg-gray-800 text-white text-xs px-2 py-1 rounded-md 
                                opacity-0 group-hover:opacity-100 transition duration-300 pointer-events-none whitespace-nowrap z-50 shadow-lg">
                        Seleccionar Todo
                    </div>
                </label>
                
            </div>
        {% endif %}

        {% url 'exportar_candidatos_excel' estado=status_key as base_export_url %}
        {% with filter_date=request.GET.fecha_inicio %}
            
            <a href="{{ base_export_url }}{% if filter_date %}?fecha_filtro={{ filter_date }}{% endif %}" 
            class="text-green-700 hover:text-red-900 ml-2 p-1 rounded-full hover:bg-red-50 transition duration-150" 
            title="Exportar '{% if status_key == 'CAPACITACION_PRACTICA' %}OJT{% else %}{{ title }}{% endif %}' a Excel">
                <svg class="inline w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            </a>  
        {% endwith %}
    </h3>
    {# --- FIN: CABECERA DE LA COLUMNA (H3) --- #}
    
    
    <div id="column-{{ status_key }}" 
        data-status="{{ status_key }}"
        class="p-3 space-y-3 min-h-[300px] max-h-[70vh] overflow-y-auto kanban-column-body flex-grow" 
        ondragover="allowDrop(event)" 
        ondrop="drop(event)">
        
        {% for item in data %}
        {% with proceso=item.proceso candidato=item.candidato %}
        
        <div class="kanban-card bg-white p-3 rounded-lg shadow-md border-l-4 border-{{ color|slice:"7:"|default:'red-500' }}/80 hover:shadow-xl hover:border-{{ color|slice:"7:"|default:'sky-700' }} transition duration-150 cursor-pointer active:cursor-grabbing relative group"
            
            data-dni="{{ candidato.DNI }}" 
            data-candidato-id="{{ candidato.pk }}"
            data-proceso-id="{{ proceso.pk|default:'None' }}" 
            
            data-proceso-estado="{{ candidato.estado_actual }}"
            data-proceso-empresa="{{ proceso.empresa_proceso.nombre|default:'' }}"
            data-proceso-supervisor="{{ proceso.supervisor.nombre|default:'' }}"
            data-proceso-objetivo="{{ proceso.objetivo_ventas_alcanzado|yesno:'true,false,false' }}"
            data-proceso-actitud="{{ proceso.factor_actitud_aplica|yesno:'true,false,false' }}"
            
            draggable="true" 
            ondragstart="drag(event)"
            onclick="toggleCardSelection(this)"

            {% if proceso %}
            ondblclick="openUpdateProcessModal(
                '{{ proceso.pk }}', 
                '{{ candidato.nombres_completos }}', 
                '{{ candidato.estado_actual }}', 
                '{{ proceso.empresa_proceso.nombre|default:'' }}',
                '{{ proceso.supervisor.nombre|default:'' }}',
                '{{ proceso.objetivo_ventas_alcanzado|yesno:'true,false,false' }}',
                '{{ proceso.factor_actitud_aplica|yesno:'true,false,false' }}'
            )"
            {% else %}
            ondblclick="window.location.href='{% url 'detalle_candidato' dni=candidato.DNI %}'"
            {% endif %}
            >
            
            {# ... Contenido de la Tarjeta (Bot贸n de Historial) ... #}

            <button 
                onclick="event.stopPropagation(); openHistoryModal('{{ candidato.DNI }}', '{{ candidato.nombres_completos }}')"
                class="absolute top-1.5 right-1.5 p-1 hidden text-red-500 hover:text-red-700 rounded-lg hover:bg-red-50 transition duration-150 z-10 opacity-0 group-hover:opacity-100"
                title="Ver Historial del Candidato">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            </button>

            
            <div class="block space-y-1"> 
                
                <h4 class="text-xs font-bold text-gray-900 leading-tight truncate pr-7 group-hover:text-red-700 transition-colors">
                    {{ candidato.nombres_completos }}
                </h4>
                
                {# AQUI ESTABA EL SPAN DEL ESTADO DEL PROCESO QUE SE ELIMIN #}

                <p class="text-[11px] text-gray-500 flex items-center space-x-1 border-b border-dashed border-gray-100 pb-1 pt-1">
                    <span class="font-medium">DNI: <span class="text-gray-700">{{ candidato.DNI }}</span></span>
                    <span class="text-gray-300">|</span>
                    <a href="https://api.whatsapp.com/send?phone=51{{ candidato.telefono_whatsapp }}" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="flex items-center space-x-1"> 
                        
                        <span class="font-medium text-blue-500 flex items-center">
                            Cel: 
                            <span class="text-gray-700 text-blue-600 mr-1">
                                {{ candidato.telefono_whatsapp }}
                            </span>
                            
                            <svg class="w-4 w-4 fill-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M476.9 161.1C435 119.1 379.2 96 319.9 96C197.5 96 97.9 195.6 97.9 318C97.9 357.1 108.1 395.3 127.5 429L96 544L213.7 513.1C246.1 530.8 282.6 540.1 319.8 540.1L319.9 540.1C442.2 540.1 544 440.5 544 318.1C544 258.8 518.8 203.1 476.9 161.1zM319.9 502.7C286.7 502.7 254.2 493.8 225.9 477L219.2 473L149.4 491.3L168 423.2L163.6 416.2C145.1 386.8 135.4 352.9 135.4 318C135.4 216.3 218.2 133.5 320 133.5C369.3 133.5 415.6 152.7 450.4 187.6C485.2 222.5 506.6 268.8 506.5 318.1C506.5 419.9 421.6 502.7 319.9 502.7zM421.1 364.5C415.6 361.7 388.3 348.3 383.2 346.5C378.1 344.6 374.4 343.7 370.7 349.3C367 354.9 356.4 367.3 353.1 371.1C349.9 374.8 346.6 375.3 341.1 372.5C308.5 356.2 287.1 343.4 265.6 306.5C259.9 296.7 271.3 297.4 281.9 276.2C283.7 272.5 282.8 269.3 281.4 266.5C280 263.7 268.9 236.4 264.3 225.3C259.8 214.5 255.2 216 251.8 215.8C248.6 215.6 244.9 215.6 241.2 215.6C237.5 215.6 231.5 217 226.4 222.5C221.3 228.1 207 241.5 207 268.8C207 296.1 226.9 322.5 229.6 326.2C232.4 329.9 268.7 385.9 324.4 410C359.6 425.2 373.4 426.5 391 423.9C401.7 422.3 423.8 410.5 428.4 397.5C433 384.5 433 373.4 431.6 371.1C430.3 368.6 426.6 367.2 421.1 364.5z"/></svg>
                        </span>
                    </a>
                </p>
                
                <div class="pt-1 space-y-1">
                    {% if status_key == 'REGISTRADO' and not proceso %}
                        <p class="text-xs text-red-600 font-bold flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.398 16c-.77 1.333.192 3 1.732 3z" /></svg>
                            Pendiente de Convocatoria
                        </p>
                    {% elif proceso %}
                        <div class="text-[10px] text-gray-500 space-y-0.5">
    
                            {# FECHA INICIO (CONVOCADO color) #}
                            <p class="flex items-center">
                                <span class="font-bold text-gray-700 mr-1">Inicio:</span>
                                
                                {% if proceso.estado == 'CONVOCADO' or proceso.estado == 'CONFIRMADO' %}
                                    <a href="#" 
                                    onclick="event.preventDefault(); event.stopPropagation(); openDateEditModal('{{ proceso.pk }}', 'inicio', '{{ proceso.fecha_inicio|date:"Y-m-d" }}', 'Inicio del Proceso', '{{ candidato.nombres_completos }}')"
                                    class="px-1 py-0.5 rounded-sm bg-indigo-100 text-indigo-700 font-medium hover:bg-indigo-200 transition duration-150 cursor-pointer">
                                        {{ proceso.fecha_inicio|date:"d/m/Y" }}
                                    </a>
                                {% else %}
                                    <span class="px-1 py-0.5 rounded-sm bg-indigo-100 text-indigo-700 font-medium">
                                        {{ proceso.fecha_inicio|date:"d/m/Y" }}
                                    </span>
                                {% endif %}
                            </p>

                            {# FECHA TERICO (TEORIA color) #}
                            {% if proceso.fecha_teorico %}
                            <p class="flex items-center">
                                    <span class="font-bold text-gray-700 mr-1">Te贸rico:</span>
                                    
                                    {% if proceso.estado == 'CONVOCADO' or proceso.estado == 'CONFIRMADO' or proceso.estado == 'TEORIA' %}
                                        <a href="#" 
                                        onclick="event.preventDefault(); event.stopPropagation(); openDateEditModal('{{ proceso.pk }}', 'teorico', '{{ proceso.fecha_teorico|date:"Y-m-d" }}', 'Te贸rico', '{{ candidato.nombres_completos }}')"
                                        class="px-1 py-0.5 rounded-sm bg-amber-100 text-amber-700 font-medium hover:bg-amber-200 transition duration-150 cursor-pointer">
                                            {{ proceso.fecha_teorico|date:"d/m/Y" }}
                                        </a>
                                    {% else %}
                                        <span class="px-1 py-0.5 rounded-sm bg-amber-100 text-amber-700 font-medium">
                                            {{ proceso.fecha_teorico|date:"d/m/Y" }}
                                        </span>
                                    {% endif %}
                                </p>
                            {% endif %}

                            {# FECHA PRCTICO (PRACTICA/OJT color) #}
                            {% if proceso.fecha_practico %}
                            <p class="flex items-center">
                                    <span class="font-bold text-gray-700 mr-1">Pr谩ctico:</span>
                                    
                                    {% if proceso.estado == 'TEORIA' or proceso.estado == 'PRACTICA' %}
                                        <a href="#" 
                                        onclick="event.preventDefault(); event.stopPropagation(); openDateEditModal('{{ proceso.pk }}', 'practico', '{{ proceso.fecha_practico|date:"Y-m-d" }}', 'Pr谩ctico (OJT)', '{{ candidato.nombres_completos }}')"
                                        class="px-1 py-0.5 rounded-sm bg-orange-100 text-orange-700 font-medium hover:bg-orange-200 transition duration-150 cursor-pointer">
                                            {{ proceso.fecha_practico|date:"d/m/Y" }}
                                        </a>
                                    {% else %}
                                        <span class="px-1 py-0.5 rounded-sm bg-orange-100 text-orange-700 font-medium">
                                            {{ proceso.fecha_practico|date:"d/m/Y" }}
                                        </span>
                                    {% endif %}
                                </p>
                            {% endif %}

                            {# FECHA CONTRATACIN (CONTRATADO color) #}
                            {% if proceso.fecha_contratacion %}
                            <p class="flex items-center">
                                    <span class="font-bold text-gray-700 mr-1">Contrato:</span>
                                    
                                    {% if proceso.estado == 'PRACTICA' or proceso.estado == 'CONTRATADO' %}
                                        <a href="#" 
                                        onclick="event.preventDefault(); event.stopPropagation(); openDateEditModal('{{ proceso.pk }}', 'contratacion', '{{ proceso.fecha_contratacion|date:"Y-m-d" }}', 'Contrataci贸n', '{{ candidato.nombres_completos }}')"
                                        class="px-1 py-0.5 rounded-sm bg-green-100 text-green-700 font-bold hover:bg-green-200 transition duration-150 cursor-pointer">
                                            {{ proceso.fecha_contratacion|date:"d/m/Y" }}
                                        </a>
                                    {% else %}
                                        <span class="px-1 py-0.5 rounded-sm bg-green-100 text-green-700 font-bold">
                                            {{ proceso.fecha_contratacion|date:"d/m/Y" }}
                                        </span>
                                    {% endif %}
                                </p>
                            {% endif %}

                            {% if proceso.supervisor and status_key == 'CAPACITACION_PRACTICA' or proceso.supervisor and status_key == 'CONTRATADO' %}
                                <p class="text-xs text-gray-700 font-medium flex items-center pt-1 border-t border-dashed border-gray-100 mt-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                    Sup.: <span class="font-semibold ml-1 text-gray-900">{{ proceso.supervisor.nombre|truncatechars:18 }}</span>
                                </p>
                            {% endif %}
                            
                            <p class="text-xs text-gray-700 font-medium flex items-center pt-0.5">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.24a3.001 3.001 0 010 4.243L10.58 18.42a2 2 0 01-2.83 0l-4.244-4.243a3.001 3.001 0 014.243-4.243L12 9.172l.44-1.24a3.001 3.001 0 014.243 0z" /></svg>
                                Estado: 
                                <span class="font-bold px-1.5 py-0.5 rounded-full text-[10px] ml-1 uppercase tracking-wider" 
                                    {% if proceso.estado == 'INICIADO' %}
                                        style="background-color: #eef2ff; color: #3F51B5;"
                                    {% elif proceso.estado == 'CONFIRMADO' %}
                                        style="background-color: #e0f7fa; color: #00838f;"
                                    {% elif proceso.estado == 'TEORIA' %}
                                        style="background-color: #FFFDE7; color: #F57F17;"
                                    {% elif proceso.estado == 'PRACTICA' %}
                                        style="background-color: #FFF3E0; color: #b45309;"
                                    {% else %}
                                        style="background-color: #E8F5E9; color: #4CAF50;"
                                    {% endif %}>
                                    {{ item.proceso_status }}
                                </span>
                            </p>
                        </div>
                    {% endif %}
                </div>

                <div class="flex items-center justify-between mt-2 pt-2 border-t border-red-100">
                    <div class="flex items-center space-x-1">
                        
                        {# Botones de acci贸n de la tarjeta (Subir Tests, Documentos, Comentarios, Historial) (No Modificado) #}

                        {% if proceso %}
                        <button 
                            onclick="event.stopPropagation(); openTestUploadModal('{{ proceso.pk }}', '{{ candidato.nombres_completos }}')"
                            class="p-1 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 transition duration-150"
                            title="Subir Tests y Archivos">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                            </svg>
                        </button>
                        {% endif %}

                        {% if proceso %}
                            <button 
                                onclick="event.stopPropagation(); openDocumentUploadModal('{{ proceso.pk }}', '{{ candidato.nombres_completos }}')"
                                class="p-1 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 transition duration-150"
                                title="Subir Certificados o Documentos Laborales">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m-9 5h16a2 2 0 002-2V7a2 2 0 00-2-2H9.586a1 1 0 01-.707-.293l-1.586-1.586A1 1 0 006.586 3H4a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                </svg>
                            </button>
                        {% endif %}

                        {% if proceso %}
                        <button 
                            onclick="event.stopPropagation(); openCommentModal('{{ proceso.pk }}', '{{ candidato.nombres_completos }}')"
                            class="p-1 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 transition duration-150"
                            title="Ver/A帽adir Comentarios">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                            </svg>
                        </button>
                        {% endif %}

                        <button 
                            onclick="event.stopPropagation(); openHistoryModal('{{ candidato.DNI }}', '{{ candidato.nombres_completos }}')"
                            class="p-1 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 transition duration-150"
                            title="Ver Historial del Candidato">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </button>
                        
                    </div>

                    
                    {% if status_key == 'REGISTRADO' %}
                        <button 
                            onclick="event.stopPropagation(); openConvocarModal('{{ candidato.DNI }}', '{{ candidato.nombres_completos }}')"
                            class="text-[11px] font-bold px-2 hidden py-1 bg-red-700 text-white rounded-md hover:bg-red-800 transition duration-150 shadow-md shadow-red-200/50"
                            title="Iniciar Proceso de Convocatoria">
                             Convocar
                        </button>
                    {% endif %}
                    
                </div>
            </div> 

        </div>
        {% endwith %}
        {% empty %}
        <div class="text-center py-6 text-gray-500 text-sm">
            No hay candidatos en este estado.
        </div>
        {% endfor %}
    </div>
</div>

<div id="dateEditModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6">
        
        <h3 class="text-xl font-extrabold text-red-700 border-b pb-2 mb-4">Reprogramar Fecha</h3>
        <p class="text-sm text-gray-500 mb-4">Candidato: <span id="modal-candidato-nombre" class="font-semibold text-gray-800"></span></p>

        <form id="dateEditForm">
            {% csrf_token %} <input type="hidden" id="modal-proceso-id" name="proceso_id">
            <input type="hidden" id="modal-date-type" name="date_type">
            
            <div class="mb-4">
                <label for="new_date" class="block text-sm font-medium text-gray-700">
                    Nueva Fecha de <span id="modal-date-title" class="font-bold"></span>:
                </label>
                <input type="date" id="new_date" name="new_date" required
                       class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-red-500 focus:border-red-500 transition duration-150">
            </div>
            
            <div class="flex justify-end space-x-3 pt-3 border-t">
                <button type="button" onclick="closeDateEditModal()" class="px-4 py-2 text-gray-600 rounded-md hover:bg-gray-100 transition duration-150">
                    Cancelar
                </button>
                <button type="submit" class="px-4 py-2 bg-red-700 text-white rounded-md hover:bg-red-800 shadow-lg shadow-red-200/50 transition duration-150">
                     Guardar Fecha
                </button>
            </div>
        </form>
    </div>
</div>

<div id="comment-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="slide-over-title-comment" role="dialog" aria-modal="true">
    
    <div class="absolute inset-0 bg-gray-900 bg-opacity-75 transition-opacity" onclick="closeCommentModal()" id="comment-upload-overlay"></div>

    <div class="fixed inset-y-0 right-0 max-w-full flex">
        <div class="w-screen max-w-md transform transition ease-in-out duration-500 sm:duration-700 translate-x-full" id="comment-panel">
            <div class="h-full flex flex-col bg-white shadow-xl overflow-y-auto">
                
                <div class="px-4 py-4 bg-red-700 sm:px-6">
                    <div class="flex items-start justify-between">
                        <h2 class="text-xl font-bold text-white" id="slide-over-title-comment">
                            锔 Registrar Observaci贸n
                        </h2>
                        <div class="ml-3 h-7 flex items-center">
                            <button type="button" class="bg-red-700 rounded-md text-red-200 hover:text-white focus:outline-none focus:ring-2 focus:ring-white" onclick="closeCommentModal()">
                                <span class="sr-only">Cerrar panel</span>
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="relative flex-1 py-6 px-4 sm:px-6">
                    
                    <div class="p-3 bg-gray-50 border border-red-200 rounded-lg mb-6 shadow-sm">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Candidato:</p>
                        <p class="text-lg font-bold text-red-800 truncate" id="comment-candidato-nombre">--</p>
                        <p class="text-sm text-gray-600 mt-1">
                            <span class="font-medium">Proceso ID:</span> 
                            <span id="comment-proceso-id-display" class="font-bold text-gray-700">--</span>
                        </p>
                    </div>

                    <form id="registro-comentario-form" method="POST" action="{% url 'registrar_observacion' %}" class="space-y-6">
                        {% csrf_token %}
                        
                        <input type="hidden" id="input-proceso-id-comentarios" name="proceso_id" value="">
                        
                        <div>
                            <label for="observacion_texto" class="block text-sm font-medium text-gray-700 mb-2">Observaci贸n (M谩x. 500 caracteres):</label>
                            <textarea 
                                id="observacion_texto" 
                                name="observacion_texto" 
                                rows="6" 
                                required 
                                maxlength="500"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition duration-150 shadow-sm"
                                placeholder="Escriba aqu铆 sus comentarios, aptitudes o aspectos a mejorar..."></textarea>
                            <p class="text-right text-xs text-gray-500 mt-1"><span id="char-count">0</span> / 500</p>
                        </div>

                        <div class="pt-4 border-t border-gray-200">
                            <button 
                                type="submit" 
                                id="btn-guardar-comentario"
                                class="w-full flex justify-center items-center bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition duration-150 shadow-lg shadow-red-300/50 disabled:bg-red-400"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.134 7-7 7a6.96 6.96 0 01-3.692-.997l-3.53 1.059a.5.5 0 01-.63-.63l1.059-3.53A7 7 0 1118 10zm-6-4a1 1 0 10-2 0v2H8a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V6z" clip-rule="evenodd" /></svg>
                                Guardar Observaci贸n
                            </button>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<div id="test-upload-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="slide-over-title" role="dialog" aria-modal="true">
    
    <div class="absolute inset-0 bg-gray-900 bg-opacity-75 transition-opacity" onclick="closeTestUploadModal()" id="test-upload-overlay"></div>

    <div class="fixed inset-y-0 right-0 max-w-full flex">
        <div class="w-screen max-w-md transform transition ease-in-out duration-500 sm:duration-700 translate-x-full" id="test-upload-panel">
            <div class="h-full flex flex-col bg-white shadow-xl overflow-y-auto">
                
                <div class="px-4 py-4 bg-red-700 sm:px-6">
                    <div class="flex items-start justify-between">
                        <h2 class="text-xl font-bold text-white" id="slide-over-title">
                             Registro de Test / Archivo
                        </h2>
                        <div class="ml-3 h-7 flex items-center">
                            <button type="button" class="bg-red-700 rounded-md text-red-200 hover:text-white focus:outline-none focus:ring-2 focus:ring-white" onclick="closeTestUploadModal()">
                                <span class="sr-only">Cerrar panel</span>
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="relative flex-1 py-6 px-4 sm:px-6">
                    
                    <div class="p-3 bg-gray-50 border border-red-200 rounded-lg mb-6 shadow-sm">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Candidato:</p>
                        <p class="text-lg font-bold text-red-800 truncate" id="test-candidato-nombre">--</p>
                        <p class="text-sm text-gray-600 mt-1">
                            <span class="font-medium">Proceso ID:</span> 
                            <span id="test-proceso-id-display" class="font-bold text-gray-700">--</span>
                        </p>
                    </div>

                    <form id="registro-test-form" method="POST" action="{% url 'registrar_test_archivo' %}" enctype="multipart/form-data" class="space-y-6">
                        {% csrf_token %}
                        
                        <input type="hidden" id="input-proceso-id-test" name="proceso_id" value="">
                        
                        <div>
                            <label for="tipo_test" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Documento:</label>
                            <select id="tipo_test" name="tipo_test" required 
                                    class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 transition duration-150">
                                <option value="" disabled selected>Seleccione el tipo de test/archivo</option>
                                <option value="PSICOLOGICO">Test Psicol贸gico</option>
                                <option value="CONOCIMIENTO">Test de Conocimiento</option>
                                <option value="VENTAS_PRACTICA">Simulaci贸n/Prueba de Ventas</option>
                                <option value="DOCUMENTO">Documento/Archivo Adicional</option>
                                <option value="OTRO">Otro</option>
                            </select>
                        </div>

                        <div>
                            <label for="archivo" class="block text-sm font-medium text-gray-700 mb-1">Archivo del Test (PDF, JPG, PNG):</label>
                            <input type="file" id="archivo" name="archivo" required accept=".pdf, .jpg, .jpeg, .png"
                                    class="w-full p-3 border border-gray-300 rounded-lg shadow-sm bg-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100">
                            <p class="text-xs text-gray-500 mt-1">Archivos permitidos: PDF, JPG, PNG. M谩x. 5MB.</p>
                        </div>

                        <div>
                            <label for="resultado_obtenido" class="block text-sm font-medium text-gray-700 mb-1">Resultado/Calificaci贸n (Opcional):</label>
                            <input type="text" id="resultado_obtenido" name="resultado_obtenido" maxlength="50"
                                    class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 transition duration-150"
                                    placeholder="Ej: Apto, 9/10, No Apto">
                        </div>

                        <div class="pt-4 border-t border-gray-200">
                            <button 
                                type="submit" 
                                id="btn-guardar-test"
                                class="w-full flex justify-center items-center bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition duration-150 shadow-lg shadow-red-300/50 disabled:bg-red-400"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L6.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                                Subir y Registrar Test
                            </button>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<div id="document-upload-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="slide-over-title-docs" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-gray-900 bg-opacity-75 transition-opacity" onclick="closeDocumentUploadModal()" id="document-upload-overlay"></div>
    <div class="fixed inset-y-0 right-0 max-w-full flex">
        <div class="w-screen max-w-md transform transition ease-in-out duration-500 sm:duration-700 translate-x-full" id="document-upload-panel">
            <div class="h-full flex flex-col bg-white shadow-xl overflow-y-auto">
                <div class="px-4 py-4 bg-red-700 sm:px-6">
                    <div class="flex items-start justify-between">
                        <h2 class="text-lg font-bold text-white" id="slide-over-title-docs">
                             Certificados y Documentos
                        </h2>
                        <div class="ml-3 h-7 flex items-center">
                            <button type="button" class="bg-red-700 rounded-md text-red-200 hover:text-white focus:outline-none focus:ring-2 focus:ring-white" onclick="closeDocumentUploadModal()">
                                <span class="sr-only">Cerrar panel</span>
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="relative flex-1 py-6 px-4 sm:px-6">
                    <div class="p-3 bg-gray-50 border border-red-200 rounded-lg mb-6 shadow-sm">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Candidato:</p>
                        <p class="text-lg font-bold text-red-800 truncate" id="doc-candidato-nombre">--</p>
                        <p class="text-sm text-gray-600 mt-1">
                            <span class="font-medium">Proceso ID:</span> 
                            <span id="doc-proceso-id-display" class="font-bold text-gray-700">--</span>
                        </p>
                    </div>
                    <form id="registro-documento-form" 
                        method="POST" 
                        action="{% url 'registrar_documento_laboral' %}" 
                        enctype="multipart/form-data" 
                        class="space-y-6"
                        hx-post="{% url 'registrar_documento_laboral' %}" hx-encoding="multipart/form-data" hx-target="#registro-documento-form" hx-swap="none" hx-on::after-request="closeDocumentUploadModal(); mostrarToastExito('Documento subido con 茅xito.')"> 
                        {% csrf_token %}
                        <input type="hidden" id="input-proceso-id-doc" name="proceso_id" value="">
                        <div>
                            <label for="tipo_documento" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Documento:</label>
                            <select id="tipo_documento" name="tipo_documento" required 
                                    class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 transition duration-150">
                                <option value="" disabled selected>Seleccione el tipo de documento</option>
                                <option value="CERTIFICADO_LABORAL">Certificado de Experiencia Laboral</option>
                                <option value="CUL">Certificado nico Laboral (CUL)</option>
                                <option value="ANTECEDENTES">Certificado de Antecedentes</option>
                                <option value="CURRICULUM">Curriculum Vitae (CV)</option>
                                <option value="OTRO">Otro Documento</option>
                            </select>
                        </div>

                        <div>
                            <label for="archivo_doc" class="block text-sm font-medium text-gray-700 mb-1">Archivo del Documento (PDF, JPG, PNG):</label>
                            <input type="file" id="archivo_doc" name="archivo_doc" required accept=".pdf, .jpg, .jpeg, .png"
                                    class="w-full p-3 border border-gray-300 rounded-lg shadow-sm bg-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100">
                            <p class="text-xs text-gray-500 mt-1">Archivos permitidos: PDF, JPG, PNG. M谩x. 5MB.</p>
                        </div>

                        <div>
                            <label for="observaciones_doc" class="block text-sm font-medium text-gray-700 mb-1">Observaciones (Opcional):</label>
                            <textarea id="observaciones_doc" name="observaciones_doc" rows="3"
                                    class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 transition duration-150"
                                    placeholder="Notas sobre la validez o contenido del documento..."></textarea>
                        </div>

                        <div class="pt-4 border-t border-gray-200">
                            <button 
                                type="submit" 
                                id="btn-guardar-doc"
                                class="w-full flex justify-center items-center bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition duration-150 shadow-lg shadow-red-300/50 disabled:bg-red-400"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" /></svg>
                                Subir Documento
                            </button>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/kanban_column.js' %}"></script>